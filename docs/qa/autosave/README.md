# Autosave Stress Harness Evidence – Choir Demo

This directory captures the autosave cadence drill requested in the Step 8 QA hand-off:

- `runs/choir_demo_summary.json` – JSON transcript emitted by the harness-driven `TrackerMixerRoot` loop (6 iterations, 0.75 s synthetic interval). The run processed long enough between iterations to advance the timestamp slug, producing five retained checkpoints and pruning one older entry (`pruned_checkpoints: 1`).
- `.autosave/choir_demo/` – Layout + manifest copies generated by the harness. Each layout file mirrors the telemetry surfaced inside `TransportControlsWidget.recovery_prompt`, allowing QA testers to cross-reference crash notes with the saved manifest digest (`1af91433`).

To reproduce the drill locally:

```bash
PYTHONPATH=src python - <<'PY'
import json
import time
from pathlib import Path

from tools import autosave_stress_harness as harness
from gui.app import TrackerMixerRoot
from gui.preview import PreviewBatchState
from gui.state import MixerPanelState, TrackerMixerLayoutState, TrackerPanelState

autosave_dir = Path('docs/qa/autosave/.autosave')
autosave_dir.mkdir(parents=True, exist_ok=True)
project_id = 'choir_demo'
manifest_index = harness._load_manifest(Path('docs/assets/audio/sampler_s3_manifest.json'))
if manifest_index is None:
    raise SystemExit('Sampler manifest missing')
root = TrackerMixerRoot()
root.configure_sampler_manifest(manifest_index, manifest_path=Path('docs/assets/audio/sampler_s3_manifest.json'))
time_source = harness._TimeSource(interval=0.75)
root.enable_autosave(project_id=project_id, autosave_dir=autosave_dir, interval_seconds=0.75, time_source=time_source)
start = time.perf_counter()
for iteration in range(6):
    time_source.advance()
    tracker_state = TrackerPanelState(pattern_id=f'demo_{iteration}', import_asset_count=4, tutorial_tips=['Autosave ready'])
    layout = TrackerMixerLayoutState(tracker=tracker_state, mixer=MixerPanelState())
    batch = PreviewBatchState(layout=layout, previews=[])
    root._apply_batch(batch)
    time.sleep(1.05)
duration = time.perf_counter() - start
summary = {
    'iterations': 6,
    'checkpoints_written': len(root._autosave_config.checkpoints),
    'pruned_checkpoints': root._autosave_config.pruned_checkpoints,
    'latest_prompt': root.transport_controls.recovery_prompt,
    'duration_seconds': duration,
    'autosave_dir': str(autosave_dir / project_id),
}
Path('docs/qa/autosave/runs/choir_demo_summary.json').write_text(json.dumps(summary, indent=2) + '\n', encoding='utf-8')
PY
```

Use the resulting `.autosave/choir_demo` folder when sharing crash reports with the musician test group.
